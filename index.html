<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Skočko Demo</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin:0; padding:0; }
    .symbols { margin: 20px; display:flex; flex-wrap:wrap; justify-content:center; }
    .symbols button { margin: 5px; border: none; background: none; cursor: pointer; }
    .symbols img { width: 80px; height: 80px; }

    .board { display: flex; flex-direction: column; align-items: center; margin-top: 20px; }

    .row { display: flex; align-items: center; justify-content: center; margin: 5px; }

    .cell { 
      width: 80px; height: 80px; 
      border: 1px solid #333; margin: 2px; 
      display:flex; align-items:center; justify-content:center; 
    }
    .cell img { width: 70px; height: 70px; }

    .feedback { display:flex; margin-left: 20px; }
    .feedback span { 
      width: 80px; height: 80px; 
      border-radius: 50%; margin: 2px; 
      display:flex; align-items:center; justify-content:center;
      border: 1px solid #333;
    }

    .red { background: red; }
    .yellow { background: gold; }
    .black { background: black; }

    #timer { font-size: 20px; margin-top: 10px; }
    #secret { margin-top: 20px; }

    button.confirm {
      font-size: 24px;
      padding: 15px 30px;
      margin-top: 10px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Skočko Demo</h1>

  <!-- Unos imena -->
  <div id="start">
    <input type="text" id="playerName" placeholder="Unesi ime">
    <button class="confirm" onclick="startGame()">Start</button>
  </div>

  <div id="game" style="display:none;">
    <div class="symbols">
      <button onclick="choose('car.png')"><img src="car.png"></button>
      <button onclick="choose('gear.png')"><img src="gear.png"></button>
      <button onclick="choose('mouse.png')"><img src="mouse.png"></button>
      <button onclick="choose('lightbulb.png')"><img src="lightbulb.png"></button>
      <button onclick="choose('smartphone.png')"><img src="smartphone.png"></button>
      <button onclick="choose('computer.png')"><img src="computer.png"></button>
    </div>

    <div id="timer">Vrijeme: 120s</div>

    <div class="board" id="attempts"><h3>Pokušaji</h3></div>

    <div id="current"></div>
    <button class="confirm" onclick="submitGuess()">Potvrdi</button>
    <p id="message"></p>
    <div id="secret"></div>
  </div>

  <script>
    const symbols = ['car.png','gear.png','mouse.png','lightbulb.png','smartphone.png','computer.png'];
    let secret = [];
    let currentGuess = [];
    let attempts = 0;
    let gameOver = false;
    let timeLeft = 120;
    let countdown;
    let playerName = "";

    function startGame() {
      playerName = document.getElementById("playerName").value.trim();
      if (!playerName) {
        alert("Molim te unesi ime!");
        return;
      }
      document.getElementById("start").style.display = "none";
      document.getElementById("game").style.display = "block";

      // generiši kombinaciju
      secret = Array.from({length:4}, () => symbols[Math.floor(Math.random()*symbols.length)]);

      // pokreni tajmer
      timeLeft = 120;
      const timerElement = document.getElementById("timer");
      countdown = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(countdown);
          endGame("Vrijeme je isteklo!");
        } else {
          timeLeft--;
          timerElement.textContent = "Vrijeme: " + timeLeft + "s";
        }
      }, 1000);
    }

    function choose(sym) {
      if (gameOver) return;
      if (currentGuess.length < 4) {
        currentGuess.push(sym);
        renderCurrentGuess();
      }
    }

    function renderCurrentGuess() {
      const preview = document.getElementById('current');
      preview.innerHTML = '';
      const row = document.createElement('div');
      row.className = 'row';
      currentGuess.forEach((sym, index) => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.innerHTML = `<img src="${sym}">`;
        // klik briše ikonicu
        cell.onclick = () => {
          currentGuess.splice(index, 1);
          renderCurrentGuess();
        };
        row.appendChild(cell);
      });
      preview.appendChild(row);
    }

    function submitGuess() {
      if (gameOver) return;
      if (currentGuess.length < 4) return;

      attempts++;

      const row = document.createElement('div');
      row.className = 'row';

      currentGuess.forEach(sym => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.innerHTML = `<img src="${sym}">`;
        row.appendChild(cell);
      });

      const feedback = getFeedback(secret, currentGuess);
      const fbDiv = document.createElement('div');
      fbDiv.className = 'feedback';
      feedback.forEach(color => {
        const dot = document.createElement('span');
        dot.className = color;
        fbDiv.appendChild(dot);
      });
      row.appendChild(fbDiv);

      document.getElementById('attempts').appendChild(row);

      if (currentGuess.join('') === secret.join('')) {
        endGame("Bravo! Pogodio si u " + attempts + " pokušaja.");
      } else if (attempts >= 6) {
        endGame("Iskoristio si svih 6 pokušaja!");
      } else {
        currentGuess = [];
        document.getElementById('current').innerHTML = '';
      }
    }

    function getFeedback(secret, guess) {
      let reds = 0, yellows = 0;
      let secretCopy = [...secret];
      let guessCopy = [...guess];

      for (let i = 0; i < 4; i++) {
        if (guessCopy[i] === secretCopy[i]) {
          reds++;
          secretCopy[i] = null;
          guessCopy[i] = null;
        }
      }

      for (let i = 0; i < 4; i++) {
        if (guessCopy[i] !== null) {
          let index = secretCopy.indexOf(guessCopy[i]);
          if (index !== -1) {
            yellows++;
            secretCopy[index] = null;
          }
        }
      }

      let blacks = 4 - reds - yellows;
      let feedback = [];
      for (let i = 0; i < reds; i++) feedback.push('red');
      for (let i = 0; i < yellows; i++) feedback.push('yellow');
      for (let i = 0; i < blacks; i++) feedback.push('black');
      return feedback;
    }

    function endGame(msg) {
      gameOver = true;
      clearInterval(countdown);
      document.getElementById('message').textContent = msg;
      showSecret();

      // onemogući dugmad
      document.querySelectorAll(".symbols button").forEach(btn => btn.disabled = true);
      document.querySelector(".confirm").disabled = true;

      // rezultat
      let result = {
        name: playerName,
        attempts: attempts,
        time: 120 - timeLeft,
        success: msg.includes("Bravo")
      };

      // slanje u Google Sheets
      fetch("https://script.google.com/macros/s/AKfycbxqGAFz4Z8TOjvImw-vZaXsnKsxLT0Y5Bb4Nzq9jxtctQ6vcpvCU7c5RF21TBrJhLhz/exec", {
        method: "POST",
        body: JSON.stringify(result),
      });
    }

    function showSecret() {
      const secretDiv = document.getElementById('secret');
      secretDiv.innerHTML = "<h3>Zamišljena kombinacija:</h3>";
      const row = document.createElement('div');
      row.className = 'row';
      secret.forEach(sym => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.innerHTML = `<img src="${sym}">`;
        row.appendChild(cell);
      });
      secretDiv.appendChild(row);
    }
  </script>
</body>
</html>